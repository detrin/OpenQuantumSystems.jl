using Test
using OpenQuantumSystems
using Random, SparseArrays, LinearAlgebra, StableRNGs

@testset "rate_constant" begin

    Random.seed!(StableRNG(0), 1)

    D(op1::Array, op2::Array) = abs(norm(op1 - op2))
    D(x1::StateVector, x2::StateVector) = norm(x2 - x1)
    D(op1::AbstractOperator, op2::AbstractOperator) =
        abs(tracedistance_nh(dense(op1), dense(op2)))
    D(op1::AbstractSuperOperator, op2::AbstractSuperOperator) =
        abs(tracedistance_nh(dense(op1), dense(op2)))


    mode1 = Mode(0.2, 1.0)
    mode2 = Mode(0.3, 2.0)
    Energy = [0.0, 200.0]
    mol1 = Molecule([mode1], 3, [2.0, 200.0])
    mol2 = Molecule([mode2], 3, [3.0, 300.0])
    aggCore = AggregateCore([mol1, mol2])
    aggCore.coupling[2, 3] = 50
    aggCore.coupling[3, 2] = 50
    agg = setupAggregate(aggCore)
    aggTools = agg.tools
    aggOperators = agg.operators

    Ham_B = agg.operators.Ham_B
    Ham_I = agg.operators.Ham_I
    Ham_0 = agg.operators.Ham_0
    Ham = agg.operators.Ham

    Ham_0_lambda, Ham_0_S = eigen(Ham_0.data)
    Ham_0_Sinv = inv(Ham_0_S)
    Ham_0_lambda = diagm(Ham_0_lambda)

    basis = agg.tools.basis
    indicesLen = agg.tools.bSize
    indices = agg.tools.indices
    indicesMap = agg.tools.indicesMap
    FCFact = agg.tools.FCfactors
    FCProd = agg.tools.FCproduct

    tspan = get_tspan(0., 0.02, 100)
    W0, rho0, W0_bath = ultrafast_laser_excitation(10., [0.0, 0.3, 0.7], agg)

    tmp1 = copy(W0.data)
    tmp2 = copy(W0.data)
    p = (agg.core, agg.tools, agg.operators, W0, W0_bath, eltype(W0))

    t = 0.01
    ref = ComplexF64[0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.22193301968099788 + 2.7877794867961354e-18im -3.6173729680411446e-9 - 6.71420992197389e-6im -1.9577513524464922e-7 + 1.0582528772025405e-10im -3.0472528147808174e-7 + 2.079245969432672e-7im 1.2786023930113329e-8 - 1.0646330805494376e-5im -1.0750918863415662e-7 + 8.273368661440277e-7im -2.1339639767700418e-7 - 6.61297073108041e-10im 8.378984635391596e-8 - 1.5597039491627985e-5im 2.6652188460544764e-8 + 1.2611759746529425e-9im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.6173729680978813e-9 + 6.714209921973865e-6im 0.22055872333765705 - 6.701040724519382e-19im 2.8633933694137977e-9 - 9.425952776300713e-6im -1.625116799180591e-8 + 2.1327113117770604e-6im -4.255089084318047e-7 + 2.066645302981879e-7im 5.698373329682394e-8 - 1.5165619675282082e-5im -2.724482972466403e-9 - 2.2242757439225877e-6im -1.9176762360677246e-7 - 3.883146134878248e-10im 1.2586253311772524e-7 - 2.1910300735685956e-5im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.9577513524464964e-7 - 1.0582528772250928e-10im 2.863393369411455e-9 + 9.425952776300829e-6im 0.21919404067534523 + 3.2881546961543176e-18im -9.666204999326959e-8 - 4.1330785771096313e-7im 1.4283141365576973e-8 + 3.029264578936157e-6im 3.116577481067589e-7 + 2.0643528157985244e-7im -4.04863242495167e-9 - 3.953511771302817e-11im 1.6844164734139438e-8 - 3.1356080243394954e-6im 4.443235909205322e-7 + 2.462815825188607e-9im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.0472528147807777e-7 - 2.0792459694325784e-7im -1.625116799173643e-8 - 2.1327113117770007e-6im -9.666204999327513e-8 + 4.1330785771096234e-7im 0.22101621947064237 + 1.3562169666718826e-18im 1.9196242415292402e-8 - 6.686508840023646e-6im 7.486148190132446e-9 + 9.661999300670311e-10im -1.350656708681131e-7 - 5.298810684809175e-10im 6.990143484755347e-8 - 1.1118977373475209e-5im 1.3742882498708222e-7 + 1.5205366246554453e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.2786023930042631e-8 + 1.0646330805494322e-5im -4.2550890843179925e-7 - 2.066645302981962e-7im 1.4283141365547903e-8 - 3.0292645789361107e-6im 1.919624241526646e-8 + 6.6865088400237425e-6im 0.2196479242803733 - 1.8258586726120336e-19im 3.24713792415411e-8 - 9.386945081456927e-6im 5.54666892991146e-9 + 2.2262175436240928e-6im 3.7062087098509226e-8 - 1.2085221099274895e-10im 9.001188222670985e-8 - 1.5616437406419354e-5im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.0750918863417575e-7 - 8.273368661440369e-7im 5.698373329680576e-8 + 1.5165619675282031e-5im 3.116577481067746e-7 - 2.0643528157983934e-7im 7.486148190131278e-9 - 9.661999300664234e-10im 3.2471379241522715e-8 + 9.38694508145699e-6im 0.21828870918067161 + 1.3372458229810862e-18im 1.0208052513758602e-7 - 6.185610741361663e-10im 3.6771442982682747e-8 + 3.1194177590446372e-6im 5.944153683753908e-7 + 1.7139870073757438e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -2.1339639767700225e-7 + 6.612970731092765e-10im -2.7244829724602182e-9 + 2.224275743922578e-6im -4.048632424954487e-9 + 3.953511771103453e-11im -1.3506567086811787e-7 + 5.298810684811072e-10im 5.546668929964334e-9 - 2.2262175436240864e-6im 1.0208052513758405e-7 + 6.185610741351038e-10im 0.2201032075551495 - 4.928108889070402e-19im 1.2618585525447398e-8 - 6.658922448508765e-6im 1.9540183589765254e-7 + 8.639871207986571e-10im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 8.378984635391102e-8 + 1.5597039491628053e-5im -1.9176762360677828e-7 + 3.883146134896205e-10im 1.6844164734105364e-8 + 3.1356080243393104e-6im 6.99014348475503e-8 + 1.1118977373475287e-5im 3.706208709851866e-8 + 1.2085221099526493e-10im 3.677144298266334e-8 - 3.11941775904461e-6im 1.2618585525380575e-8 + 6.658922448508722e-6im 0.21874082925865715 - 4.407507084023526e-18im 1.7707578222664067e-8 - 9.349084107884108e-6im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 2.665218846054296e-8 - 1.2611759746544382e-9im 1.2586253311774488e-7 + 2.1910300735686e-5im 4.443235909205331e-7 - 2.462815825185598e-9im 1.3742882498708082e-7 - 1.520536624655422e-9im 9.001188222668802e-8 + 1.5616437406419384e-5im 5.944153683753924e-7 - 1.713987007373179e-9im 1.9540183589765294e-7 - 8.63987120799393e-10im 1.7707578222681967e-8 + 9.349084107884053e-6im 0.2173870886963461 - 1.9091058390098977e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1778831203896421 + 4.3138790558143803e-19im -4.4766224708292885e-8 + 6.066368080820869e-6im 2.45891942541654e-7 + 1.2927585086193847e-9im 3.6430683557704354e-7 - 6.182954212103557e-7im -3.598913768637602e-8 + 8.543179542692773e-6im 1.426905230637072e-7 - 2.459544152086955e-6im 2.720295000922853e-7 + 9.40312563389647e-10im -6.944130447707898e-8 + 1.40884570302491e-5im -5.300977081058342e-9 + 2.518939607171088e-10im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -4.4766224708315656e-8 - 6.066368080820939e-6im 0.1767822259143153 - 5.591117423561556e-19im -1.8165690056195192e-8 + 8.509190910668716e-6im -7.660198208011822e-9 - 1.7131731606366645e-6im 5.485482577004697e-7 - 6.140957839550911e-7im -2.3951724621675193e-8 + 1.2625335435987045e-5im -3.4915354975858667e-9 + 2.0058576881844033e-6im 2.670943182770664e-7 + 8.558940707293369e-10im -7.849786735710407e-8 + 1.9783702639794916e-5im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 2.4589194254165183e-7 - 1.292758508618287e-9im -1.8165690056191526e-8 - 8.509190910668738e-6im 0.17568679241483548 - 1.926324442536304e-19im 1.3367376474183744e-7 + 1.2300621928065536e-6im 3.4567335613865897e-9 - 2.5180417938683762e-6im -3.5760934756751345e-7 - 6.115642939592375e-7im 1.152520551836229e-9 - 6.457729475568595e-12im -1.2877665078446732e-10 + 2.8358678590981938e-6im -5.499254159814096e-7 - 1.5256450866887756e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 3.6430683557704915e-7 + 6.182954212103589e-7im -7.660198207994352e-9 + 1.7131731606366221e-6im 1.3367376474184871e-7 - 1.2300621928065473e-6im 0.177148022754418 + 5.593752415878748e-19im -9.418255991027583e-9 + 6.0413134984482605e-6im 1.47485606935968e-8 + 2.7656209453140084e-10im 1.8376417291660613e-7 + 2.8534255434354505e-10im -3.160572075237134e-8 + 1.0043939921651453e-5im -1.3012623686256652e-7 - 6.691197072441684e-10im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.598913768638645e-8 - 8.543179542692802e-6im 5.485482577004732e-7 + 6.140957839550902e-7im 3.456733561392632e-9 + 2.5180417938683267e-6im -9.418255991020393e-9 - 6.041313498448269e-6im 0.17605132290486422 - 2.679091655779752e-19im 1.9076825073034036e-8 + 8.474122685770952e-6im 1.292313099570252e-9 - 2.0136525908557214e-6im 1.1667554158747145e-9 - 1.616463236322357e-10im -3.484751352005223e-8 + 1.4099379430225845e-5im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.4269052306370763e-7 + 2.4595441520869598e-6im -2.3951724621625082e-8 - 1.262533543598697e-5im -3.576093475675039e-7 + 6.115642939592397e-7im 1.474856069359938e-8 - 2.765620945304196e-10im 1.907682507304795e-8 - 8.474122685771079e-6im 0.1749605888542 + 5.731687283812941e-19im -1.2407226493668623e-7 + 1.7107982720927874e-10im 1.141967746230305e-8 - 2.8134593759799925e-6im -7.270212864584079e-7 - 1.2660155866060181e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 2.720295000922873e-7 - 9.403125633896398e-10im -3.4915354975659718e-9 - 2.005857688184446e-6im 1.1525205518350736e-9 + 6.4577294758512536e-12im 1.837641729166027e-7 - 2.853425543438914e-10im 1.292313099569259e-9 + 2.0136525908556867e-6im -1.2407226493669091e-7 - 1.710798272090915e-10im 0.17641594090217777 - 2.354613189538821e-19im -9.798440842208581e-9 + 6.016314152234916e-6im -2.5950843772550656e-7 - 1.0727345332832651e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -6.944130447706442e-8 - 1.4088457030249037e-5im 2.6709431827707246e-7 - 8.558940707320335e-10im -1.287766507718846e-10 - 2.8358678590981387e-6im -3.160572075236808e-8 - 1.0043939921651399e-5im 1.1667554158819718e-9 + 1.6164632363052768e-10im 1.1419677462315025e-8 + 2.8134593759801606e-6im -9.798440842222426e-9 - 6.0163141522348145e-6im 0.17532337970400866 - 3.3599746133077505e-19im -1.3723848056749049e-8 + 8.438794768640681e-6im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im -5.3009770810613086e-9 - 2.518939607177471e-10im -7.849786735708692e-8 - 1.978370263979488e-5im -5.499254159814137e-7 + 1.5256450866886935e-9im -1.3012623686256488e-7 + 6.691197072430352e-10im -3.484751352005208e-8 - 1.4099379430225906e-5im -7.270212864584074e-7 + 1.2660155866058812e-9im -2.595084377255046e-7 + 1.0727345332827554e-9im -1.3723848056760161e-8 - 8.438794768640685e-6im 0.17423731296555192 - 3.085875869863563e-19im]
    W_1_bath_ = W_1_bath_1(t, p, tmp1, tmp2)
    # @test D(ref, W_1_bath_) < 1e-11
    W_1_bath_ = W_1_bath_1(t, W0, W0_bath, agg)
    # @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_normalized = normalize_bath(W_1_bath_, aggCore, aggTools, aggOperators)
    rho_ = trace_bath(W_1_bath_normalized, agg.core, agg.tools)
    ref = ComplexF64[1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im;1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im;1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im]
    @test D(ref, rho_) < 1e-14

    ref = ComplexF64[0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.22193301967842047 + 5.8983664959212865e-19im 1.6523145011743253e-8 - 6.7140671793188065e-6im -1.957691196697674e-7 - 1.0562203268220483e-9im -3.058257469651639e-7 + 2.0734273898483045e-7im 6.174976435136237e-8 - 1.064607079078501e-5im -1.250095489512355e-7 + 8.263570024256528e-7im -2.1339155673904754e-7 - 1.502693807648995e-9im 1.9296636996459066e-7 - 1.5596067855677882e-5im 2.6644090722584434e-8 + 1.4422065611941286e-9im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.652314501176772e-8 + 6.714067179318922e-6im 0.22055872333650792 - 1.690492712537588e-18im 3.114338835810867e-8 - 9.425950567904477e-6im -1.4289739385787216e-8 + 2.132685313493151e-6im -4.2660160031956235e-7 + 2.0582351590795438e-7im 1.2857452462718998e-7 - 1.5165223032304318e-5im -4.995927018295251e-10 - 2.22427248219619e-6im -1.9176481562636643e-7 - 1.1261302408286043e-9im 2.7923325197655205e-7 - 2.1908917075500627e-5im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.957691196697651e-7 + 1.0562203268192222e-9im 3.114338835815892e-8 + 9.425950567904541e-6im 0.21919404067726955 + 1.1417529387552377e-18im -1.010357019610085e-7 - 4.129050704030821e-7im 1.7143865649252026e-8 + 3.0292781194688576e-6im 3.1056986350172476e-7 + 2.0701563517733935e-7im -4.048001868064863e-9 - 3.387140526465081e-11im 1.9979146176030433e-8 - 3.135534096639631e-6im 4.443104977024784e-7 + 4.257181842285973e-9im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.0582574696518293e-7 - 2.073427389848227e-7im -1.4289739385926882e-8 - 2.132685313493131e-6im -1.010357019610362e-7 + 4.1290507040305467e-7im 0.2210162194710163 - 4.076104710041403e-18im 3.9256369792323314e-8 - 6.6863802911593115e-6im 7.484576997989423e-9 + 9.887529760543797e-10im -1.3506395277919478e-7 - 8.024428157530429e-10im 1.2549466740998548e-7 - 1.1118468463498898e-5im 1.3741437567407125e-7 + 2.5959496786185775e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 6.17497643513024e-8 + 1.0646070790784941e-5im -4.266016003195307e-7 - 2.0582351590797058e-7im 1.7143865649224405e-8 - 3.0292781194688487e-6im 3.925636979240266e-8 + 6.686380291159257e-6im 0.21964792428147323 - 3.9881976063641163e-19im 6.063478625828335e-8 - 9.386877204044828e-6im 7.773904144332014e-9 + 2.2262157604553314e-6im 3.70618573710916e-8 + 3.5208226860932254e-11im 1.6809255485926812e-7 - 1.5615744162808515e-5im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.2500954895123762e-7 - 8.263570024256331e-7im 1.2857452462715335e-7 + 1.5165223032304457e-5im 3.1056986350172444e-7 - 2.0701563517735857e-7im 7.484576997990925e-9 - 9.887529760537053e-10im 6.063478625820314e-8 + 9.386877204044754e-6im 0.21828870918099996 - 8.194583414750928e-19im 1.020789246548937e-7 - 1.01469537189528e-9im 3.989090724548002e-8 + 3.119522881721485e-6im 5.944088750819854e-7 + 3.022742718849609e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -2.1339155673904664e-7 + 1.5026938076485473e-9im -4.995927019114142e-10 + 2.224272482196173e-6im -4.048001868065947e-9 + 3.387140526415309e-11im -1.3506395277919512e-7 + 8.024428157542469e-10im 7.773904144355821e-9 - 2.226215760455285e-6im 1.0207892465489261e-7 + 1.0146953718962465e-9im 0.2201032075551495 + 9.588925024545169e-20im 3.2595266122259346e-8 - 6.658854627680335e-6im 1.9539313478353588e-7 + 2.0363755500079887e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 1.929663699645697e-7 + 1.559606785567794e-5im -1.9176481562637087e-7 + 1.126130240824479e-9im 1.997914617609406e-8 + 3.135534096639666e-6im 1.2549466741005165e-7 + 1.1118468463498813e-5im 3.7061857371094606e-8 - 3.5208226865264645e-11im 3.989090724534297e-8 - 3.1195228817215813e-6im 3.2595266122215334e-8 + 6.6588546276803425e-6im 0.21874082925865718 + 3.0391484812102874e-18im 4.575470879149625e-8 - 9.348988914382216e-6im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 2.6644090722581142e-8 - 1.4422065611939367e-9im 2.7923325197647804e-7 + 2.1908917075500613e-5im 4.4431049770247835e-7 - 4.257181842286229e-9im 1.374143756740737e-7 - 2.595949678617211e-9im 1.6809255485905223e-7 + 1.561574416280851e-5im 5.944088750819837e-7 - 3.0227427188526285e-9im 1.9539313478353556e-7 - 2.036375550010425e-9im 4.575470879153827e-8 + 9.348988914382097e-6im 0.2173870886963461 - 5.702818738379085e-19im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.17788312038586487 - 6.0711183595385176e-21im -6.081820910815283e-8 + 6.066181434234687e-6im 2.4588003068080605e-7 + 2.6999879251640837e-9im 3.6554077444211475e-7 - 6.176061052057453e-7im -7.278606100181314e-8 + 8.542896115276507e-6im 1.6236325551226978e-7 - 2.4583678772886607e-6im 2.72022993891517e-7 + 1.976391458849835e-9im -1.5649503230523556e-7 + 1.408769817998604e-5im -5.302830330260858e-9 + 2.1829593597219853e-10im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -6.081820910814395e-8 - 6.06618143423463e-6im 0.17678222591006804 + 1.3300002937655046e-19im -4.071459739141954e-8 + 8.50912073343382e-6im -9.133414965222504e-9 - 1.713153051939031e-6im 5.497740407776458e-7 - 6.130480689627895e-7im -7.879632942971191e-8 + 1.2625112044716031e-5im -5.267231480366231e-9 + 2.0058520517179578e-6im 2.6708953287339673e-7 + 1.869148689362752e-9im -2.0076308873403974e-7 + 1.978278101001266e-5im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 2.4588003068080753e-7 - 2.6999879251652645e-9im -4.071459739142382e-8 - 8.509120733433665e-6im 0.1756867924149128 + 4.760366013565677e-19im 1.3859276099944107e-7 + 1.2295399553731462e-6im 1.2555758968383811e-9 - 2.5180525827562084e-6im -3.563854095853872e-7 - 6.122341588497418e-7im 1.152451026647957e-9 - 8.03462993195476e-12im -2.6424521701475654e-9 + 2.835850806922187e-6im -5.499141140981534e-7 - 3.633129485662886e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 3.6554077444211433e-7 + 6.17606105205741e-7im -9.133414965191027e-9 + 1.713153051938969e-6im 1.3859276099942556e-7 - 1.2295399553731327e-6im 0.17714802275334537 + 4.930276551669022e-19im -2.5419264964104152e-8 + 6.041251551599661e-6im 1.4746704252036124e-8 + 3.6540690812641856e-10im 1.83762831971365e-7 + 6.374055102830751e-10im -7.594156646479728e-8 + 1.0043677148645858e-5im -1.3011728935623677e-7 - 1.6600076647603873e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -7.278606100182977e-8 - 8.54289611527647e-6im 5.497740407776395e-7 + 6.130480689627878e-7im 1.2555758968583803e-9 + 2.5180525827561686e-6im -2.5419264964122883e-8 - 6.041251551599642e-6im 0.17605132290487802 + 7.1925799932300345e-19im -3.380051638863033e-9 + 8.474165840929396e-6im -4.927033678753128e-10 - 2.0136544638585314e-6im 1.168589463845139e-9 - 1.8158769001563887e-10im -9.708988418282648e-8 + 1.4099052624488754e-5im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.623632555122655e-7 + 2.458367877288661e-6im -7.87963294296836e-8 - 1.2625112044716016e-5im -3.5638540958538505e-7 + 6.122341588497395e-7im 1.4746704252038387e-8 - 3.654069081262832e-10im -3.380051638815001e-9 - 8.474165840929406e-6im 0.17496058885445184 - 2.452033791481036e-19im -1.2407065870555566e-7 + 6.413153527197383e-10im 8.928536521744445e-9 - 2.8135104416750005e-6im -7.270153084444245e-7 - 2.6891648987244922e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 2.720229938915188e-7 - 1.976391458849062e-9im -5.267231480359929e-9 - 2.0058520517179023e-6im 1.1524510266471211e-9 + 8.034629931383555e-12im 1.8376283197136738e-7 - 6.374055102837392e-10im -4.927033678764252e-10 + 2.0136544638585903e-6im -1.2407065870555635e-7 - 6.413153527195642e-10im 0.17641594090205492 + 5.730690572105018e-19im -2.5738503635028872e-8 + 6.016263428023126e-6im -2.594975911352074e-7 - 2.5619960105400487e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -1.5649503230525853e-7 - 1.4087698179986046e-5im 2.670895328733948e-7 - 1.8691486893658367e-9im -2.6424521701366172e-9 - 2.8358508069221587e-6im -7.594156646480251e-8 - 1.0043677148645934e-5im 1.1685894638536193e-9 + 1.8158769001714183e-10im 8.928536521744288e-9 + 2.813510441674949e-6im -2.5738503635031973e-8 - 6.016263428023012e-6im 0.17532337970733985 + 6.6146538366916e-19im -3.6071830946090055e-8 + 8.438723721708262e-6im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im -5.302830330267368e-9 - 2.1829593597245364e-10im -2.0076308873402823e-7 - 1.978278101001275e-5im -5.499141140981566e-7 + 3.6331294856607605e-9im -1.3011728935623722e-7 + 1.6600076647606232e-9im -9.708988418281338e-8 - 1.4099052624488656e-5im -7.270153084444324e-7 + 2.689164898722826e-9im -2.594975911352133e-7 + 2.5619960105391334e-9im -3.607183094610633e-8 - 8.438723721708182e-6im 0.17423731297109785 + 6.111033140281859e-19im]
    W_1_bath_ = W_1_bath_2(t, p, tmp1, tmp2)
    # @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_ = W_1_bath_2(t, W0, W0_bath, agg)
    # @test D(ref, W_1_bath_) < 1e-11

    ref = ComplexF64[0.1523639192898371 + 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09086999406699503 - 0.07041991681154827im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17683797078600402 + 0.04406290259988863im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546423 - 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09030741850027767 - 0.06998394754561835im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17574316801140785 + 0.04379010944461383im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08974832583538628 - 0.0695506773626956im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17465514315396338 + 0.04351900515006241im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09049455563140929 - 0.07012896990797178im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17610734708798662 + 0.043880852326975965im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216672 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08993430440170586 - 0.06969480189250792im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17501706760014954 + 0.043609186243805644im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08937752168387252 - 0.0692633218085208im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.1739335380258241 + 0.043339202043662525im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15110750672866582 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09012066835713227 - 0.06983922508051996im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17537974203458337 + 0.04369955421290698im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662568 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08956273186121272 - 0.06940685087347638im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17429396714509554 + 0.04342901054523053im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412083 + 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08900824954666091 - 0.06897715349245276im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17321491428117894 + 0.043160141811713904im; -0.09086999406699504 + 0.07041991681154827im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.17177737907537016 + 7.528730553499358e-18im 1.6523145011743253e-8 - 6.7140671793188065e-6im -1.957691196697674e-7 - 1.0562203268220483e-9im -3.058257469651639e-7 + 2.0734273898483045e-7im 6.174976435136237e-8 - 1.064607079078501e-5im -1.250095489512355e-7 + 8.263570024256528e-7im -2.1339155673904754e-7 - 1.502693807648995e-9im 1.9296636996459066e-7 - 1.5596067855677882e-5im 2.6644090722584434e-8 + 1.4422065611941286e-9im 0.1009543876717105 - 0.08255354112025307im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im -0.09030741850027767 + 0.06998394754561833im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.652314501176772e-8 + 6.714067179318922e-6im 0.17071359599172337 - 8.629386616444816e-18im 3.114338835810867e-8 - 9.425950567904477e-6im -1.4289739385787216e-8 + 2.132685313493151e-6im -4.2660160031956235e-7 + 2.0582351590795438e-7im 1.2857452462718998e-7 - 1.5165223032304318e-5im -4.995927018295251e-10 - 2.22427248219619e-6im -1.9176481562636643e-7 - 1.1261302408286043e-9im 2.7923325197655205e-7 - 2.1908917075500627e-5im 0.0 + 0.0im 0.10032937968705993 - 0.08204245266187801im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im -0.08974832583538626 + 0.0695506773626956im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.957691196697651e-7 + 1.0562203268192222e-9im 3.114338835815892e-8 + 9.425950567904541e-6im 0.16965750420510478 - 1.2736034869059219e-17im -1.010357019610085e-7 - 4.129050704030821e-7im 1.7143865649252026e-8 + 3.0292781194688576e-6im 3.1056986350172476e-7 + 2.0701563517733935e-7im -4.048001868064863e-9 - 3.387140526465081e-11im 1.9979146176030433e-8 - 3.135534096639631e-6im 4.443104977024784e-7 + 4.257181842285973e-9im 0.0 + 0.0im 0.0 + 0.0im 0.09970824112294566 - 0.08153452834896223im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09049455563140928 + 0.07012896990797178im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.0582574696518293e-7 - 2.073427389848227e-7im -1.4289739385926882e-8 - 2.132685313493131e-6im -1.010357019610362e-7 + 4.1290507040305467e-7im 0.17106780189507353 - 1.1014998613948632e-17im 3.9256369792323314e-8 - 6.6863802911593115e-6im 7.484576997989423e-9 + 9.887529760543797e-10im -1.3506395277919478e-7 - 8.024428157530429e-10im 1.2549466740998548e-7 - 1.1118468463498898e-5im 1.3741437567407125e-7 + 2.5959496786185775e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.10053728455904787 - 0.08221246293874243im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08993430440170586 + 0.0696948018925079im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 6.17497643513024e-8 + 1.0646070790784941e-5im -4.266016003195307e-7 - 2.0582351590797058e-7im 1.7143865649224405e-8 - 3.0292781194688487e-6im 3.925636979240266e-8 + 6.686380291159257e-6im 0.17000873704732744 + 6.540074143270817e-18im 6.063478625828335e-8 - 9.386877204044828e-6im 7.773904144332014e-9 + 2.2262157604553314e-6im 3.70618573710916e-8 + 3.5208226860932254e-11im 1.6809255485926812e-7 - 1.5615744162808515e-5im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09991485885716728 - 0.08170348609326256im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08937752168387253 + 0.06926332180852078im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -1.2500954895123762e-7 - 8.263570024256331e-7im 1.2857452462715335e-7 + 1.5165223032304457e-5im 3.1056986350172444e-7 - 2.0701563517735857e-7im 7.484576997990925e-9 - 9.887529760537053e-10im 6.063478625820314e-8 + 9.386877204044754e-6im 0.168956837845533 + 1.3058329466339363e-17im 1.020789246548937e-7 - 1.01469537189528e-9im 3.989090724548002e-8 + 3.119522881721485e-6im 5.944088750819854e-7 + 3.022742718849609e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0992962865889264 - 0.08119766032025971im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.09012066835713227 + 0.06983922508051994im 0.0 + 0.0im 0.0 + 0.0im -2.1339155673904664e-7 + 1.5026938076485473e-9im -4.995927019114142e-10 + 2.224272482196173e-6im -4.048001868065947e-9 + 3.387140526415309e-11im -1.3506395277919512e-7 + 8.024428157542469e-10im 7.773904144355821e-9 - 2.226215760455285e-6im 1.0207892465489261e-7 + 1.0146953718962465e-9im 0.17036115684372827 + 7.03478315415268e-18im 3.2595266122259346e-8 - 6.658854627680335e-6im 1.9539313478353588e-7 + 2.0363755500079887e-9im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.10012190474945905 - 0.08187279395572677im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08956273186121273 + 0.06940685087347637im 0.0 + 0.0im 1.929663699645697e-7 + 1.559606785567794e-5im -1.9176481562637087e-7 + 1.126130240824479e-9im 1.997914617609406e-8 + 3.135534096639666e-6im 1.2549466741005165e-7 + 1.1118468463498813e-5im 3.7061857371094606e-8 - 3.5208226865264645e-11im 3.989090724534297e-8 - 3.1195228817215813e-6im 3.2595266122215334e-8 + 6.6588546276803425e-6im 0.1693067312730612 + 9.978042385117517e-18im 4.575470879149625e-8 - 9.348988914382216e-6im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09950205066138978 - 0.08136591999880305im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.08900824954666091 + 0.06897715349245279im 2.6644090722581142e-8 - 1.4422065611939367e-9im 2.7923325197647804e-7 + 2.1908917075500613e-5im 4.4431049770247835e-7 - 4.257181842286229e-9im 1.374143756740737e-7 - 2.595949678617211e-9im 1.6809255485905223e-7 + 1.561574416280851e-5im 5.944088750819837e-7 - 3.0227427188526285e-9im 1.9539313478353556e-7 - 2.036375550010425e-9im 4.575470879153827e-8 + 9.348988914382097e-6im 0.1682590369031699 - 7.509175777745137e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09888603408611518 - 0.08086218409538634im; -0.17683797078600405 - 0.04406290259988863im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1009543876717105 + 0.08255354112025307im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.22803876098891504 - 6.0711183595385176e-21im -6.081820910815283e-8 + 6.066181434234687e-6im 2.4588003068080605e-7 + 2.6999879251640837e-9im 3.6554077444211475e-7 - 6.176061052057453e-7im -7.278606100181314e-8 + 8.542896115276507e-6im 1.6236325551226978e-7 - 2.4583678772886607e-6im 2.72022993891517e-7 + 1.976391458849835e-9im -1.5649503230523556e-7 + 1.408769817998604e-5im -5.302830330260858e-9 + 2.1829593597219853e-10im; 0.0 + 0.0im -0.17574316801140788 - 0.043790109444613826im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.10032937968705995 + 0.08204245266187803im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -6.081820910814395e-8 - 6.06618143423463e-6im 0.22662735325485256 - 1.3744787778437906e-17im -4.071459739141954e-8 + 8.50912073343382e-6im -9.133414965222504e-9 - 1.713153051939031e-6im 5.497740407776458e-7 - 6.130480689627895e-7im -7.879632942971191e-8 + 1.2625112044716031e-5im -5.267231480366231e-9 + 2.0058520517179578e-6im 2.6708953287339673e-7 + 1.869148689362752e-9im -2.0076308873403974e-7 + 1.978278101001266e-5im; 0.0 + 0.0im 0.0 + 0.0im -0.1746551431539634 - 0.04351900515006241im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09970824112294566 + 0.08153452834896226im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 2.4588003068080753e-7 - 2.6999879251652645e-9im -4.071459739142382e-8 - 8.509120733433665e-6im 0.2252233288870776 + 7.414930505263796e-18im 1.3859276099944107e-7 + 1.2295399553731462e-6im 1.2555758968383811e-9 - 2.5180525827562084e-6im -3.563854095853872e-7 - 6.122341588497418e-7im 1.152451026647957e-9 - 8.03462993195476e-12im -2.6424521701475654e-9 + 2.835850806922187e-6im -5.499141140981534e-7 - 3.633129485662886e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17610734708798662 - 0.043880852326975965im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.10053728455904788 + 0.08221246293874246im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 3.6554077444211433e-7 + 6.17606105205741e-7im -9.133414965191027e-9 + 1.713153051938969e-6im 1.3859276099942556e-7 - 1.2295399553731327e-6im 0.2270964403292882 - 6.445866248740326e-18im -2.5419264964104152e-8 + 6.041251551599661e-6im 1.4746704252036124e-8 + 3.6540690812641856e-10im 1.83762831971365e-7 + 6.374055102830751e-10im -7.594156646479728e-8 + 1.0043677148645858e-5im -1.3011728935623677e-7 - 1.6600076647603873e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17501706760014954 - 0.04360918624380564im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09991485885716728 + 0.08170348609326256im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -7.278606100182977e-8 - 8.54289611527647e-6im 5.497740407776395e-7 + 6.130480689627878e-7im 1.2555758968583803e-9 + 2.5180525827561686e-6im -2.5419264964122883e-8 - 6.041251551599642e-6im 0.22569051013902375 - 6.219635904584225e-18im -3.380051638863033e-9 + 8.474165840929396e-6im -4.927033678753128e-10 - 2.0136544638585314e-6im 1.168589463845139e-9 - 1.8158769001563887e-10im -9.708988418282648e-8 + 1.4099052624488754e-5im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.1739335380258241 - 0.043339202043662525im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09929628658892639 + 0.08119766032025971im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.623632555122655e-7 + 2.458367877288661e-6im -7.87963294296836e-8 - 1.2625112044716016e-5im -3.5638540958538505e-7 + 6.122341588497395e-7im 1.4746704252038387e-8 - 3.654069081262832e-10im -3.380051638815001e-9 - 8.474165840929406e-6im 0.22429246018991883 - 2.452033791481036e-19im -1.2407065870555566e-7 + 6.413153527197383e-10im 8.928536521744445e-9 - 2.8135104416750005e-6im -7.270153084444245e-7 - 2.6891648987244922e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17537974203458334 - 0.04369955421290698im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.10012190474945902 + 0.08187279395572677im 0.0 + 0.0im 0.0 + 0.0im 2.720229938915188e-7 - 1.976391458849062e-9im -5.267231480359929e-9 - 2.0058520517179023e-6im 1.1524510266471211e-9 + 8.034629931383555e-12im 1.8376283197136738e-7 - 6.374055102837392e-10im -4.927033678764252e-10 + 2.0136544638585903e-6im -1.2407065870555635e-7 - 6.413153527195642e-10im 0.22615799161347605 + 1.4450856865024958e-17im -2.5738503635028872e-8 + 6.016263428023126e-6im -2.594975911352074e-7 - 2.5619960105400487e-9im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17429396714509554 - 0.04342901054523054im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.09950205066138978 + 0.08136591999880305im 0.0 + 0.0im -1.5649503230525853e-7 - 1.4087698179986046e-5im 2.670895328733948e-7 - 1.8691486893658367e-9im -2.6424521701366172e-9 - 2.8358508069221587e-6im -7.594156646480251e-8 - 1.0043677148645934e-5im 1.1685894638536193e-9 + 1.8158769001714183e-10im 8.928536521744288e-9 + 2.813510441674949e-6im -2.5738503635031973e-8 - 6.016263428023012e-6im 0.22475747769293578 + 7.600359287576388e-18im -3.6071830946090055e-8 + 8.438723721708262e-6im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.17321491428117897 - 0.04316014181171392im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0988860340861152 + 0.08086218409538636im -5.302830330267368e-9 - 2.1829593597245364e-10im -2.0076308873402823e-7 - 1.978278101001275e-5im -5.499141140981566e-7 + 3.6331294856607605e-9im -1.3011728935623722e-7 + 1.6600076647606232e-9im -9.708988418281338e-8 - 1.4099052624488656e-5im -7.270153084444324e-7 + 2.689164898722826e-9im -2.594975911352133e-7 + 2.5619960105391334e-9im -3.607183094610633e-8 - 8.438723721708182e-6im 0.22336536476427402 - 1.3266684493786272e-17im]
    W_1_bath_ = W_1_bath_3(t, p, tmp1, tmp2)
    # @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_ = W_1_bath_3(t, W0, W0_bath, agg)
    # @test D(ref, W_1_bath_) < 1e-11

end
