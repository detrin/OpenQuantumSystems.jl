using Test
using OpenQuantumSystems
using Random, SparseArrays, LinearAlgebra, StableRNGs

@testset "rate_constant" begin

    Random.seed!(StableRNG(0), 1)

    D(op1::Array, op2::Array) = abs(norm(op1 - op2))
    D(x1::StateVector, x2::StateVector) = norm(x2 - x1)
    D(op1::AbstractOperator, op2::AbstractOperator) =
        abs(tracedistance_nh(dense(op1), dense(op2)))
    D(op1::AbstractSuperOperator, op2::AbstractSuperOperator) =
        abs(tracedistance_nh(dense(op1), dense(op2)))


    mode1 = Mode(0.2, 1.0)
    mode2 = Mode(0.3, 2.0)
    Energy = [0.0, 200.0]
    mol1 = Molecule([mode1], 3, [2.0, 200.0])
    mol2 = Molecule([mode2], 3, [3.0, 300.0])
    aggCore = AggregateCore([mol1, mol2])
    aggCore.coupling[2, 3] = 50
    aggCore.coupling[3, 2] = 50
    agg = setupAggregate(aggCore)
    aggTools = agg.tools
    aggOperators = agg.operators

    Ham_B = agg.operators.Ham_B
    Ham_I = agg.operators.Ham_I
    Ham_0 = agg.operators.Ham_0
    Ham = agg.operators.Ham

    Ham_0_lambda, Ham_0_S = eigen(Ham_0.data)
    Ham_0_Sinv = inv(Ham_0_S)
    Ham_0_lambda = diagm(Ham_0_lambda)

    basis = agg.tools.basis
    indicesLen = agg.tools.bSize
    indices = agg.tools.indices
    indicesMap = agg.tools.indicesMap
    FCFact = agg.tools.FCfactors
    FCProd = agg.tools.FCproduct

    tspan = get_tspan(0., 0.02, 100)
    W0, rho0, W0_bath = ultrafast_laser_excitation(10., [0.0, 0.3, 0.7], agg)

    tmp1 = copy(W0.data)
    tmp2 = copy(W0.data)
    p = (agg.core, agg.tools, agg.operators, W0, W0_bath, eltype(W0))

    t = 0.01
    ref = ComplexF64[0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523651409487161 - 3.0970772119919346e-23im 7.868386627845806e-13 - 1.651334282695512e-10im -8.51688399422316e-15 - 8.03912591526592e-17im -7.794078601707155e-14 + 1.9411391004017043e-11im -8.5174878766264725e-16 - 4.970566198855107e-18im -3.945860908146605e-22 + 3.741487795538906e-20im 6.060624348587404e-16 + 3.595438063407991e-18im -3.8629086801666255e-23 + 5.227928111876064e-21im 2.0040432384667535e-25 + 2.419494153928969e-27im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 7.868386627831208e-13 + 1.6513342826954993e-10im 0.1514218493110728 + 3.7488119843508325e-23im 1.1057389388287185e-12 - 2.3205597268729886e-10im 8.517564898276958e-16 - 3.4537062932733863e-18im -7.745825505517687e-14 + 1.9291215149943966e-11im -1.1969738060663324e-15 - 6.985311052157875e-18im -1.4465326929418526e-23 - 5.228053278090625e-21im 6.023103058074043e-16 + 3.573178729658463e-18im -5.428785526103988e-23 + 7.347045957673337e-21im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -8.516883994217536e-15 + 8.039125914830776e-17im 1.1057389388293856e-12 + 2.3205597268729987e-10im 0.15048439759177404 + 6.872087690757351e-23im 3.364270785296984e-22 + 3.7415460710389064e-20im 1.1969846303810673e-15 - 4.8535986615543285e-18im -7.697869189782694e-14 + 1.9171758209376703e-11im 2.0041278371084883e-25 - 1.5971218477789782e-27im -2.0328889775220158e-23 - 7.347221860096202e-21im 5.985812715088828e-16 + 3.551056920787875e-18im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -7.794078601751775e-14 - 1.9411391004016862e-11im 8.517564898309297e-16 + 3.4537062911602075e-18im 3.3642703432965394e-22 - 3.741546077432654e-20im 0.1517356291858619 + 9.227040007167671e-23im 7.835877604760286e-13 - 1.644511630626819e-10im -8.48169563951726e-15 - 8.005911464860115e-17im -1.0976520266533686e-13 + 2.7336191120034454e-11im -1.1995711362729981e-15 - 7.000356285444086e-18im -5.557206820638684e-22 + 5.269378202449286e-20im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -8.517487876637121e-16 + 4.9705661971955094e-18im -7.74582550548266e-14 - 1.9291215149943213e-11im 1.1969846303812972e-15 + 4.8535986675528176e-18im 7.8358776047723e-13 + 1.6445116306268162e-10im 0.15079623485161756 + 8.765196034132111e-23im 1.101170468275717e-12 - 2.3109721032242537e-10im 1.1995819836982124e-15 - 4.8640708061870334e-18im -1.0908564692134984e-13 + 2.716695285605063e-11im -1.6857731400605417e-15 - 9.83784628906201e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.945861223704436e-22 - 3.741487791529768e-20im -1.196973806064086e-15 + 6.985311050712138e-18im -7.697869189758517e-14 - 1.917175820937662e-11im -8.481695639494184e-15 + 8.005911465401056e-17im 1.1011704682765135e-12 + 2.3109721032242845e-10im 0.14986265630751314 + 8.920686556805393e-23im 4.738117258823569e-22 + 5.26946027466291e-20im 1.6857883845996715e-15 - 6.835626886434508e-18im -1.0841027078409995e-13 + 2.6998727002963545e-11im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 6.060624348623924e-16 - 3.595438064401818e-18im -1.446533803942828e-23 + 5.228053284180766e-21im 2.0041267662681036e-25 + 1.5971706277591268e-27im -1.097652026646221e-13 - 2.7336191120033986e-11im 1.1995819837035583e-15 + 4.8640708043161396e-18im 4.738117093146213e-22 - 5.2694602709306936e-20im 0.1511087183129731 + 3.4158130313996964e-23im 7.803503166066082e-13 - 1.6377172202110822e-10im -8.44665287287058e-15 - 7.972834453871719e-17im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -3.8629110070781484e-23 - 5.227928107109489e-21im 6.023103058091149e-16 - 3.573178725638523e-18im -2.0328903035387674e-23 + 7.347221844561371e-21im -1.1995711362638132e-15 + 7.000356275011023e-18im -1.0908564692151726e-13 - 2.7166952856050334e-11im 1.6857883845978383e-15 + 6.835626885889262e-18im 7.803503166067239e-13 + 1.6377172202110933e-10im 0.15017320518003416 + 1.4615118568475777e-22im 1.0966209107506535e-12 - 2.3014241665428528e-10im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 2.0040437102176764e-25 - 2.419594546828888e-27im -5.428785226270278e-23 - 7.347045945282214e-21im 5.985812715062555e-16 - 3.551056919454514e-18im -5.557208053445596e-22 - 5.269378203765235e-20im -1.6857731400593328e-15 + 9.837846289962847e-18im -1.0841027078332011e-13 - 2.699872700296472e-11im -8.446652872854445e-15 + 7.97283445341102e-17im 1.0966209107546345e-12 + 2.3014241665428572e-10im 0.14924348380871852 + 5.808493729515938e-23im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.2259791293296045 + 1.3998079244211608e-22im -9.894247233486348e-13 + 2.2827718886392578e-10im 1.5294374950298855e-14 + 1.2647865634191963e-16im 9.00657090258949e-14 - 2.8374516005118665e-11im -4.3267623959174466e-16 - 1.998040970894739e-18im -5.395319130558257e-23 + 7.900946891288038e-21im -4.862113704602657e-16 - 3.060395328677511e-18im -4.854891495372001e-23 + 6.330563269985544e-21im 1.0097445058563554e-25 + 9.837106194352182e-28im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -9.89424723349031e-13 - 2.2827718886392523e-10im 0.22458009394882553 + 1.0352937499629216e-22im -1.3904004223280756e-12 + 3.2076514419642387e-10im 4.326801143307617e-16 + 8.525841432195276e-19im 8.950811282014068e-14 - 2.8198849564642574e-11im -6.080947951564951e-16 - 2.8080933122410834e-18im 3.390183014901406e-23 - 6.330661113951573e-21im -4.832012390491498e-16 - 3.041448440390558e-18im -6.823217754711899e-23 + 8.897187733750686e-21im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.5294374950250104e-14 - 1.2647865634461416e-16im -1.3904004223282566e-12 - 3.207651441964242e-10im 0.22318971997718248 + 9.881987552316522e-23im 4.9413809581744855e-25 + 7.90113480700767e-21im 6.08100240781264e-16 + 1.1982474476571966e-18im 8.895398672784701e-14 - 2.8024276006840577e-11im 1.0097885532609652e-25 + 3.6525825909393427e-28im 4.764676471972741e-23 - 8.897325224205331e-21im -4.802098115226221e-16 - 3.0226193073222347e-18im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 9.006570902564375e-14 + 2.8374516005119066e-11im 4.3268011433365776e-16 - 8.525841429632858e-19im 4.9414577555379495e-25 - 7.901134820549737e-21im 0.22504547403820083 + 1.4605349606314894e-22im -9.853368164966367e-13 + 2.2733403890155937e-10im 1.523118471577701e-14 + 1.2595609708421325e-16im 1.2684213905075858e-13 - 3.996043837246469e-11im -6.093526202326088e-16 - 2.8139207487510964e-18im -7.598481060066737e-23 + 1.1127236324857589e-20im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -4.3267623959123954e-16 + 1.998040969754298e-18im 8.950811282091968e-14 + 2.81988495646428e-11im 6.081002407832418e-16 - 1.1982474466137476e-18im -9.853368164969538e-13 - 2.27334038901559e-10im 0.22365221891150996 + 7.724787518559499e-23im -1.3846558444222907e-12 + 3.194398710266658e-10im 6.093580772049141e-16 + 1.2007256739675788e-18im 1.2605686021166123e-13 - 3.971304356342191e-11im -8.564005202768123e-16 - 3.954749752042654e-18im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -5.395318961036712e-23 - 7.900946900902539e-21im -6.080947951561216e-16 + 2.808093314441404e-18im 8.895398672795816e-14 + 2.8024276006840787e-11im 1.5231184715674335e-14 - 1.2595609711074967e-16im -1.3846558444232062e-12 - 3.194398710266708e-10im 0.22226758940847996 + 7.239486963182734e-23im 6.959885273419531e-25 + 1.1127501007797408e-20im 8.564081895922974e-16 + 1.6875360432981845e-18im 1.2527646843463782e-13 - 3.946718788455866e-11im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -4.862113704603793e-16 + 3.060395328210789e-18im 3.390182540877749e-23 + 6.330661102291755e-21im 1.0097879984623855e-25 - 3.652315701267422e-28im 1.2684213905078986e-13 + 3.996043837246528e-11im 6.093580772079612e-16 - 1.2007256750705793e-18im 6.95990767652057e-25 - 1.1127500990163422e-20im 0.2241156762371643 + 6.6319413129869e-23im -9.812657918056523e-13 + 2.263947792322357e-10im 1.516825545545631e-14 + 1.2543569672458228e-16im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -4.854891219482011e-23 - 6.330563271439681e-21im -4.832012390460441e-16 + 3.04144844163836e-18im 4.764675199388697e-23 + 8.897325226763904e-21im -6.09352620237817e-16 + 2.8139207502860572e-18im 1.2605686021122934e-13 + 3.971304356342308e-11im 8.564081895958691e-16 - 1.6875360455440724e-18im -9.812657918062444e-13 - 2.2639477923223437e-10im 0.22272817748286272 + 9.453367006774695e-23im -1.3789349903455121e-12 + 3.1812006432512253e-10im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 1.009745001079775e-25 - 9.837392605555673e-28im -6.823217788657324e-23 - 8.897187699824344e-21im -4.802098115232547e-16 + 3.0226193114556336e-18im -7.598481255242516e-23 - 1.1127236338185376e-20im -8.564005202806758e-16 + 3.954749751579639e-18im 1.2527646843426838e-13 + 3.9467187884557865e-11im 1.51682554554437e-14 - 1.254356967053798e-16im -1.3789349903464536e-12 - 3.181200643251274e-10im 0.22134926871459829 + 7.347542261554316e-23im]
    W_1_bath_ = W_1_bath_1(t, p, tmp1, tmp2)
    @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_ = W_1_bath_1(t, W0, W0_bath, agg)
    @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_normalized = normalize_bath(W_1_bath_, aggCore, aggTools)
    rho_ = trace_bath(W_1_bath_normalized, agg.core, agg.tools)
    ref = ComplexF64[1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im;1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im;1.0 + 0.0im 1.0 + 0.0im 1.0 + 0.0im]
    @test D(ref, rho_) < 1e-14

    ref = ComplexF64[0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523651409487161 - 3.0970772119919346e-23im 7.868386627845806e-13 - 1.651334282695512e-10im -8.51688399422316e-15 - 8.03912591526592e-17im -7.794078601707155e-14 + 1.9411391004017043e-11im -8.5174878766264725e-16 - 4.970566198855107e-18im -3.945860908146605e-22 + 3.741487795538906e-20im 6.060624348587404e-16 + 3.595438063407991e-18im -3.8629086801666255e-23 + 5.227928111876064e-21im 2.0040432384667535e-25 + 2.419494153928969e-27im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 7.868386627831208e-13 + 1.6513342826954993e-10im 0.1514218493110728 + 3.7488119843508325e-23im 1.1057389388287185e-12 - 2.3205597268729886e-10im 8.517564898276958e-16 - 3.4537062932733863e-18im -7.745825505517687e-14 + 1.9291215149943966e-11im -1.1969738060663324e-15 - 6.985311052157875e-18im -1.4465326929418526e-23 - 5.228053278090625e-21im 6.023103058074043e-16 + 3.573178729658463e-18im -5.428785526103988e-23 + 7.347045957673337e-21im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -8.516883994217536e-15 + 8.039125914830776e-17im 1.1057389388293856e-12 + 2.3205597268729987e-10im 0.15048439759177404 + 6.872087690757351e-23im 3.364270785296984e-22 + 3.7415460710389064e-20im 1.1969846303810673e-15 - 4.8535986615543285e-18im -7.697869189782694e-14 + 1.9171758209376703e-11im 2.0041278371084883e-25 - 1.5971218477789782e-27im -2.0328889775220158e-23 - 7.347221860096202e-21im 5.985812715088828e-16 + 3.551056920787875e-18im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -7.794078601751775e-14 - 1.9411391004016862e-11im 8.517564898309297e-16 + 3.4537062911602075e-18im 3.3642703432965394e-22 - 3.741546077432654e-20im 0.1517356291858619 + 9.227040007167671e-23im 7.835877604760286e-13 - 1.644511630626819e-10im -8.48169563951726e-15 - 8.005911464860115e-17im -1.0976520266533686e-13 + 2.7336191120034454e-11im -1.1995711362729981e-15 - 7.000356285444086e-18im -5.557206820638684e-22 + 5.269378202449286e-20im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -8.517487876637121e-16 + 4.9705661971955094e-18im -7.74582550548266e-14 - 1.9291215149943213e-11im 1.1969846303812972e-15 + 4.8535986675528176e-18im 7.8358776047723e-13 + 1.6445116306268162e-10im 0.15079623485161756 + 8.765196034132111e-23im 1.101170468275717e-12 - 2.3109721032242537e-10im 1.1995819836982124e-15 - 4.8640708061870334e-18im -1.0908564692134984e-13 + 2.716695285605063e-11im -1.6857731400605417e-15 - 9.83784628906201e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -3.945861223704436e-22 - 3.741487791529768e-20im -1.196973806064086e-15 + 6.985311050712138e-18im -7.697869189758517e-14 - 1.917175820937662e-11im -8.481695639494184e-15 + 8.005911465401056e-17im 1.1011704682765135e-12 + 2.3109721032242845e-10im 0.14986265630751314 + 8.920686556805393e-23im 4.738117258823569e-22 + 5.26946027466291e-20im 1.6857883845996715e-15 - 6.835626886434508e-18im -1.0841027078409995e-13 + 2.6998727002963545e-11im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 6.060624348623924e-16 - 3.595438064401818e-18im -1.446533803942828e-23 + 5.228053284180766e-21im 2.0041267662681036e-25 + 1.5971706277591268e-27im -1.097652026646221e-13 - 2.7336191120033986e-11im 1.1995819837035583e-15 + 4.8640708043161396e-18im 4.738117093146213e-22 - 5.2694602709306936e-20im 0.1511087183129731 + 3.4158130313996964e-23im 7.803503166066082e-13 - 1.6377172202110822e-10im -8.44665287287058e-15 - 7.972834453871719e-17im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -3.8629110070781484e-23 - 5.227928107109489e-21im 6.023103058091149e-16 - 3.573178725638523e-18im -2.0328903035387674e-23 + 7.347221844561371e-21im -1.1995711362638132e-15 + 7.000356275011023e-18im -1.0908564692151726e-13 - 2.7166952856050334e-11im 1.6857883845978383e-15 + 6.835626885889262e-18im 7.803503166067239e-13 + 1.6377172202110933e-10im 0.15017320518003416 + 1.4615118568475777e-22im 1.0966209107506535e-12 - 2.3014241665428528e-10im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 2.0040437102176764e-25 - 2.419594546828888e-27im -5.428785226270278e-23 - 7.347045945282214e-21im 5.985812715062555e-16 - 3.551056919454514e-18im -5.557208053445596e-22 - 5.269378203765235e-20im -1.6857731400593328e-15 + 9.837846289962847e-18im -1.0841027078332011e-13 - 2.699872700296472e-11im -8.446652872854445e-15 + 7.97283445341102e-17im 1.0966209107546345e-12 + 2.3014241665428572e-10im 0.14924348380871852 + 5.808493729515938e-23im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im; 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1523639192898371 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.2259791293296045 + 1.3998079244211608e-22im -9.894247233486348e-13 + 2.2827718886392578e-10im 1.5294374950298855e-14 + 1.2647865634191963e-16im 9.00657090258949e-14 - 2.8374516005118665e-11im -4.3267623959174466e-16 - 1.998040970894739e-18im -5.395319130558257e-23 + 7.900946891288038e-21im -4.862113704602657e-16 - 3.060395328677511e-18im -4.854891495372001e-23 + 6.330563269985544e-21im 1.0097445058563554e-25 + 9.837106194352182e-28im; 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15142063521546414 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -9.89424723349031e-13 - 2.2827718886392523e-10im 0.22458009394882553 + 1.0352937499629216e-22im -1.3904004223280756e-12 + 3.2076514419642387e-10im 4.326801143307617e-16 + 8.525841432195276e-19im 8.950811282014068e-14 - 2.8198849564642574e-11im -6.080947951564951e-16 - 2.8080933122410834e-18im 3.390183014901406e-23 - 6.330661113951573e-21im -4.832012390491498e-16 - 3.041448440390558e-18im -6.823217754711899e-23 + 8.897187733750686e-21im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 1.5294374950250104e-14 - 1.2647865634461416e-16im -1.3904004223282566e-12 - 3.207651441964242e-10im 0.22318971997718248 + 9.881987552316522e-23im 4.9413809581744855e-25 + 7.90113480700767e-21im 6.08100240781264e-16 + 1.1982474476571966e-18im 8.895398672784701e-14 - 2.8024276006840577e-11im 1.0097885532609652e-25 + 3.6525825909393427e-28im 4.764676471972741e-23 - 8.897325224205331e-21im -4.802098115226221e-16 - 3.0226193073222347e-18im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 9.006570902564375e-14 + 2.8374516005119066e-11im 4.3268011433365776e-16 - 8.525841429632858e-19im 4.9414577555379495e-25 - 7.901134820549737e-21im 0.22504547403820083 + 1.4605349606314894e-22im -9.853368164966367e-13 + 2.2733403890155937e-10im 1.523118471577701e-14 + 1.2595609708421325e-16im 1.2684213905075858e-13 - 3.996043837246469e-11im -6.093526202326088e-16 - 2.8139207487510964e-18im -7.598481060066737e-23 + 1.1127236324857589e-20im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216675 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -4.3267623959123954e-16 + 1.998040969754298e-18im 8.950811282091968e-14 + 2.81988495646428e-11im 6.081002407832418e-16 - 1.1982474466137476e-18im -9.853368164969538e-13 - 2.27334038901559e-10im 0.22365221891150996 + 7.724787518559499e-23im -1.3846558444222907e-12 + 3.194398710266658e-10im 6.093580772049141e-16 + 1.2007256739675788e-18im 1.2605686021166123e-13 - 3.971304356342191e-11im -8.564005202768123e-16 - 3.954749752042654e-18im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -5.395318961036712e-23 - 7.900946900902539e-21im -6.080947951561216e-16 + 2.808093314441404e-18im 8.895398672795816e-14 + 2.8024276006840787e-11im 1.5231184715674335e-14 - 1.2595609711074967e-16im -1.3846558444232062e-12 - 3.194398710266708e-10im 0.22226758940847996 + 7.239486963182734e-23im 6.959885273419531e-25 + 1.1127501007797408e-20im 8.564081895922974e-16 + 1.6875360432981845e-18im 1.2527646843463782e-13 - 3.946718788455866e-11im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.1511075067286658 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -4.862113704603793e-16 + 3.060395328210789e-18im 3.390182540877749e-23 + 6.330661102291755e-21im 1.0097879984623855e-25 - 3.652315701267422e-28im 1.2684213905078986e-13 + 3.996043837246528e-11im 6.093580772079612e-16 - 1.2007256750705793e-18im 6.95990767652057e-25 - 1.1127500990163422e-20im 0.2241156762371643 + 6.6319413129869e-23im -9.812657918056523e-13 + 2.263947792322357e-10im 1.516825545545631e-14 + 1.2543569672458228e-16im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662565 + 0.0im 0.0 + 0.0im -4.854891219482011e-23 - 6.330563271439681e-21im -4.832012390460441e-16 + 3.04144844163836e-18im 4.764675199388697e-23 + 8.897325226763904e-21im -6.09352620237817e-16 + 2.8139207502860572e-18im 1.2605686021122934e-13 + 3.971304356342308e-11im 8.564081895958691e-16 - 1.6875360455440724e-18im -9.812657918062444e-13 - 2.2639477923223437e-10im 0.22272817748286272 + 9.453367006774695e-23im -1.3789349903455121e-12 + 3.1812006432512253e-10im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412077 + 0.0im 1.009745001079775e-25 - 9.837392605555673e-28im -6.823217788657324e-23 - 8.897187699824344e-21im -4.802098115232547e-16 + 3.0226193114556336e-18im -7.598481255242516e-23 - 1.1127236338185376e-20im -8.564005202806758e-16 + 3.954749751579639e-18im 1.2527646843426838e-13 + 3.9467187884557865e-11im 1.51682554554437e-14 - 1.254356967053798e-16im -1.3789349903464536e-12 - 3.181200643251274e-10im 0.22134926871459829 + 7.347542261554316e-23im]
    W_1_bath_ = W_1_bath_2(t, p, tmp1, tmp2)
    @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_ = W_1_bath_2(t, W0, W0_bath, agg)
    @test D(ref, W_1_bath_) < 1e-11

    ref = ComplexF64[0.1523639192898371 + 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.06493264512629042 - 0.11480936684672981im 0.012330659716154935 - 0.02768403390260267im -0.017205401318137404 + 0.0229916114810629im -0.007945285693248748 + 0.011677242871633214im 0.011740139679115701 - 0.016321853070721853im -0.012117571154286784 + 0.016267601892973913im -0.004909153830590784 + 0.004946044266574077im 0.006415936488128877 - 0.00769366987419648im -0.00608085322395609 + 0.0081893027855746im -0.1521487520978704 + 0.0013355966851724427im -0.010907989401033479 + 0.025783539750817604im -0.017192059665831275 + 0.02297373303991245im 0.007806427323491804 - 0.011491939958092277im 0.011653044658391279 - 0.016205261688170193im 0.01210083772741009 - 0.01624513099134516im -0.005109927963599559 + 0.005214530719669138im -0.006523189246928548 + 0.007837545763301016im -0.006069696542521887 + 0.008174289998465064im; 0.0 + 0.0im 0.15142063521546423 - 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.02158728622168558 + 0.017559063995170526im -0.04404036411504489 - 0.14929423803828343im -0.003159736042300217 - 0.003702596121076617im -0.01220689848642014 + 0.015638219721828467im 0.008706010224818555 - 0.010978318979812832im -7.470383006483472e-5 - 0.0003285202384194988im -0.005641806514734649 + 0.008424637076395028im 0.0038466904591681187 - 0.00610819060508768im 0.0003110953762144521 + 0.00022909069968949145im 0.023006808607493053 - 0.019443542118886607im -0.131715311844563 - 0.032538268778042966im 0.0041566062430174935 + 0.0023709179347976323im -0.012285334031726046 + 0.015742564921136737im -0.008783969623178251 + 0.011082355329525579im -0.00012876581540758225 - 0.00025614983705627765im 0.00552629804352521 - 0.008270652835353364im 0.0037222895115981256 - 0.00594183243890852im -0.0003919919954481586 - 0.0001205712812296746im; 0.0 + 0.0im 0.0 + 0.0im 0.1504831910069145 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.017110893727004393 + 0.02258153028991634im -0.0034089781022902743 - 0.0033198831845834328im -0.04345287784795952 - 0.14869785194315632im -0.012051451202290038 + 0.01597782188821758im -0.000278405565141126 - 5.544403551315662e-5im 0.00885839481680314 - 0.011178447214266259im -0.006047851005607316 + 0.00804358047953532im 0.00022472400244351925 + 0.0003395146717657096im 0.003902334758464468 - 0.006185113737311535im -0.01713375136345608 + 0.022611780526067004im 0.004403642523039199 + 0.001999427456392964im -0.13057828640161637 - 0.03267369948761611im 0.012060297770914838 - 0.01598955348226954im -0.0003323068240648911 + 1.6261868108180236e-5im -0.008936308375407227 + 0.011282421984825933im -0.0060495167581499565 + 0.008045794544054848im -0.0003054776988712921 - 0.00023186278220879236im 0.0037780092495824373 - 0.0060188571952521745im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15173441257438916 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.008818897440254759 - 0.010650427214990306im -0.012218654545622185 + 0.015685699147088294im 0.012091175381170804 - 0.01617373350448141im -0.060251630614378486 - 0.12399533460714234im 0.004630091136207297 - 0.015216699180723887im -0.008523805555382562 + 0.011373372928930122im -0.006324728751586081 + 0.0148881460594924im 0.011317118265617624 - 0.018786826382897817im -0.012927770392612564 + 0.017334732005732368im -0.008957550900636862 + 0.01083468759286345im -0.012292873267000378 + 0.0157846407459199im -0.012082302643831236 + 0.01616186878005158im -0.1475866024803129 - 0.007692079902878989im -0.003487535885407236 + 0.013690404320915572im -0.008518412448043482 + 0.011366146953639201im 0.005507423248887104 - 0.013797482347327im 0.010847529751277344 - 0.0181582080797676im 0.01291153340644422 - 0.017312927548291286im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15079502577216672 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.011689287019843831 - 0.016081462768198985im -0.008162218151599683 + 0.01148368287357678im -0.0002790810806877681 - 5.5222435940950176e-5im -0.012100364650089753 + 0.007122295969746484im -0.05080943562062964 - 0.14167286957659384im -0.0025725139360736 - 0.002944368128655642im -0.014295315663784355 + 0.01541703383158892im 0.010630243022978308 - 0.010346881073724766im -0.0009947104075074518 - 0.001241658314185421im 0.011623688193535427 - 0.015994556370683508im 0.008084373792649239 - 0.011380231842122095im -0.0003329357982886923 + 1.657107178947653e-5im 0.013240391768699587 - 0.008635728281808377im -0.13840763816609286 - 0.0250190960548364im 0.0033748695638519664 + 0.0018725355447481464im -0.014754825816751107 + 0.016028327328854827im -0.011112086392913615 + 0.010989891293245534im -0.001318148024211586 - 0.0008086884880350123im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14986145470778003 + 1.734723475976807e-18im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.012024797392036107 - 0.01588530324197784im -7.239262096447696e-5 - 0.0003253913687955639im -0.008312325280175625 + 0.011684792614657196im -0.008476867741360918 + 0.011170401174109466im -0.0027161854613359016 - 0.0027114327260302014im -0.05030004676626074 - 0.14098691034840632im -0.012857176971966157 + 0.017025922441307025im -0.0011356115883155435 - 0.0010377302248987586im 0.01072899128336904 - 0.010465972251482183im -0.012041432270875266 + 0.015907272701089888im -0.00012608614085961631 - 0.0002542579855905634im 0.008234526694147355 - 0.011581402816511871im -0.008489436137278778 + 0.011187035046483162im 0.0035167657080125542 + 0.0016486328055084387im -0.13735085805424221 - 0.025062094354380754im 0.012868084708067207 - 0.01704038754448113im -0.0014583125442104196 - 0.0006084384770934115im -0.011210492165933646 + 0.01110852483210517im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15110750672866582 + 0.0im 0.0 + 0.0im 0.0 + 0.0im -0.004885265806100296 + 0.0048817814816362725im 0.006389269505375603 - 0.00759908534097932im -0.006058913820586027 + 0.008091933884330191im 0.011668298121664493 - 0.00910124680746337im -0.014311734440709723 + 0.01546630043915303im 0.01287913383759759 - 0.017248598222798922im -0.05892872287378521 - 0.1322680588168994im 0.00032643308742077797 - 0.005281750995866754im -0.0023089288793621374 + 0.003074374408652989im -0.005091424904532537 + 0.005155181729878937im -0.006504692720377914 + 0.007752635805735716im -0.0060563062588761575 + 0.008088454567164153im -0.01248439753098305 + 0.010185774305142259im -0.014767080345167822 + 0.016073317109144707im -0.012868193836353197 + 0.017233968969807417im -0.14683404245265466 - 0.015205297031878874im 0.00028394978724543163 + 0.004466358896328391im -0.002308005854380072 + 0.0030731367296011297im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.15017200109662568 + 0.0im 0.0 + 0.0im -0.005624414900659429 + 0.008327106450701545im 0.0038361837100744107 - 0.006038551764109918im 0.0003076018219959046 + 0.00022845691562946405im 0.011282135184341124 - 0.018522203504959894im -0.007427577525768213 + 0.013685134795167555im -0.0011390391412928133 - 0.0010386956377625048im -0.004339084888031542 + 0.00096286066276329im -0.05665931190735287 - 0.13739674820030554im -0.0014530522980078615 - 0.0014782794382224823im 0.005517715043109833 - 0.008186043807266048im 0.003718123922149689 - 0.005881983447421779im -0.0003882959137463955 - 0.00012110828391061407im 0.010836831214037019 - 0.01793226870328321im 0.006946445193172182 - 0.013045742221682984im -0.0014619084611033355 - 0.0006082841695876493im 0.004948117184800186 - 0.0017713812190872865im -0.14445037667774305 - 0.020486144674483675im 0.0018821377155090657 + 0.0009050790742962978im; 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.0 + 0.0im 0.14924228717412083 + 1.734723475976807e-18im -0.006025577726105256 + 0.007947578221088563im 0.0002215393668328435 + 0.0003375806871365558im 0.003891658100107673 - 0.006114598473357142im 0.01280860131329022 - 0.01694117647482523im -0.000978370074109473 - 0.0012337022454789771im -0.0075162881157390705 + 0.013814151927063959im -0.0022962708699511506 + 0.003019598641713858im -0.0013794178599413661 - 0.0015526787999411787im -0.05635769306988275 - 0.1364544576604543im -0.006035717173729222 + 0.00796094173982222im -0.0003020189497330941 - 0.0002311831825100505im 0.003773705075623874 - 0.0059581721494578405im -0.012824742676786514 + 0.016962494362832484im -0.0013004980778679278 - 0.0008069519069728179im 0.007035497766306523 - 0.013175214418640719im -0.0023000214680256497 + 0.0030245609205561286im 0.0018075538458579234 + 0.0009843089642630985im -0.14360324810324673 - 0.020270303287118215im; -0.06493264512629043 + 0.11480936684672984im -0.02158728622168558 - 0.017559063995170526im -0.017110893727004393 - 0.022581530289916343im 0.008818897440254759 + 0.010650427214990306im 0.01168928701984383 + 0.016081462768198985im 0.012024797392036107 + 0.015885303241977844im -0.004885265806100296 - 0.0048817814816362725im -0.00562441490065943 - 0.008327106450701545im -0.006025577726105256 - 0.007947578221088564im 0.14312698046349911 - 3.0970772119919346e-23im -0.005865987416642288 + 0.04844585942517019im -0.02754859225090398 + 0.0014390741738529486im 0.0005822673379309644 - 0.023975365094129123im 0.01903513904299976 - 0.0010952702278732565im -3.3787141496636314e-5 - 0.03306451410913738im -0.007675996280700229 + 0.00012093341531712818im 0.0005050647911695898 + 0.01687858791326365im -0.009746169039843785 + 0.0007937506146509595im 0.06711094561237103 - 0.10812473228531036im 0.006484597589518377 + 0.010170676941424024im 0.006218701993240216 + 0.01057278952994427im -0.005196544130508331 - 0.004823891338513239im -0.0037928325594078684 - 0.007539700583190439im -0.0044195385409918336 - 0.007312619685411943im 0.005491339806880442 + 0.0012772560254116017im 0.002152768534358162 + 0.00361822243799289im 0.0022079735413033626 + 0.003690985941361885im; 0.012330659716154938 + 0.027684033902602673im -0.04404036411504488 + 0.14929423803828337im -0.0034089781022902743 + 0.003319883184583433im -0.012218654545622187 - 0.015685699147088297im -0.008162218151599683 - 0.011483682873576779im -7.239262096447695e-5 + 0.00032539136879556376im 0.006389269505375602 + 0.00759908534097932im 0.0038361837100744107 + 0.006038551764109919im 0.00022153936683284351 - 0.0003375806871365558im -0.005865987416642297 - 0.048445859425170164im 0.17729997319910362 + 1.38778252959343e-17im -0.004254128955589922 - 0.0007967412525691403im -0.01985618230332077 - 0.0008563987527535205im 0.00045516682853585826 + 0.024849232964764646im -0.00022635381381827513 - 0.00025103967850128277im 0.00043284750170036353 - 0.017843860337389637im 0.006454799399465633 + 0.0002078395551750641im 0.0002719052668496627 - 2.2586923487874168e-5im -0.006658146668594277 - 0.010533693462030865im 0.06112602499667884 - 0.12757708302175053im -0.0033181458431981786 + 0.00039361438669301493im 0.005051308235646465 + 0.006868188610236023im 0.005255094132864355 + 0.005079995512599762im 0.004594997642687889 - 0.0006158128632378736im -0.0022110339572585097 - 0.003759643756358353im -0.0031642593198646157 - 0.003336611766588491im -0.0050023207972982086 + 0.00012551978950191452im; -0.017205401318137407 - 0.022991611481062903im -0.0031597360423002165 + 0.0037025961210766173im -0.04345287784795952 + 0.14869785194315632im 0.012091175381170804 + 0.01617373350448141im -0.0002790810806877681 + 5.522243594095015e-5im -0.008312325280175626 - 0.011684792614657196im -0.006058913820586027 - 0.00809193388433019im 0.0003076018219959046 - 0.00022845691562946405im 0.0038916581001076727 + 0.006114598473357143im -0.02754859225090396 - 0.001439074173852953im -0.0042541289555899225 + 0.0007967412525691368im 0.17652040114412504 + 6.872087690757351e-23im 5.996858669526586e-5 - 0.033778029016604656im -0.00029171510788047133 + 0.00025435550694621976im 0.00038417408190524613 + 0.023775395157513094im -0.00991997118750162 + 0.0005587628108598289im 0.00039309065866746776 + 2.6478167057436372e-5im 0.00647287911761735 - 0.00047970729842866406im 0.006577885990363765 + 0.011334118206204356im 0.0033013513169667273 - 0.0004366923285483255im 0.06750701422319895 - 0.12760467627192823im -0.004662462792166764 - 0.00784711118915188im -0.0037816197880764673 - 3.1377779742052143e-5im -0.003126847127948338 + 0.005617599758096853im 0.0023667269656096586 + 0.003962625927771489im 0.0050292416471894264 - 0.00012440392062096827im 0.006830418750369755 - 0.0035558480958931367im; -0.007945285693248748 - 0.011677242871633214im -0.012206898486420138 - 0.01563821972182847im -0.012051451202290038 - 0.015977821888217576im -0.060251630614378486 + 0.12399533460714234im -0.012100364650089755 - 0.007122295969746483im -0.008476867741360918 - 0.011170401174109468im 0.011668298121664493 + 0.009101246807463369im 0.011282135184341126 + 0.018522203504959894im 0.01280860131329022 + 0.016941176474825233im 0.000582267337930966 + 0.023975365094129116im -0.019856182303320778 + 0.0008563987527535235im 5.996858669527082e-5 + 0.03377802901660466im 0.15039698510851202 + 6.9389861743073e-18im -0.004650396839361229 + 0.024155871502390836im -0.013759745686437523 + 0.00022712072949192702im 0.003264050025749034 - 0.025857859811523776im 0.018899392267842895 - 0.000850602934902315im -0.00010302637340528931 - 0.03573991191751428im 0.005261496795634221 + 0.004953424096063022im 0.0050079042308431 + 0.006775158484514863im 0.004493968677125969 + 0.007489046147944425im 0.06399058143358431 - 0.11416485385457757im 0.0032257778779588367 + 0.004865037550968312im 0.0030922543403544625 + 0.005112456920717328im -0.004058431652812911 - 0.00549527473156169im -0.001424686418404042 - 0.010707810404187088im -0.004750548376116725 - 0.0080516951961967im; 0.011740139679115703 + 0.016321853070721853im 0.008706010224818555 + 0.010978318979812834im -0.000278405565141126 + 5.544403551315662e-5im 0.004630091136207297 + 0.015216699180723887im -0.05080943562062963 + 0.14167286957659384im -0.0027161854613359016 + 0.002711432726030202im -0.014311734440709723 - 0.015466300439153034im -0.007427577525768213 - 0.013685134795167557im -0.000978370074109473 + 0.001233702245478977im 0.01903513904299976 + 0.001095270227873261im 0.00045516682853585 - 0.02484923296476465im -0.00029171510788047225 - 0.0002543555069462214im -0.004650396839361225 - 0.02415587150239085im 0.16552951901402213 - 1.3877700155854115e-17im -0.0034547042744493993 - 9.102978923532439e-6im -0.02277627303264858 - 0.0005659385198161535im 0.0021136077368459167 + 0.026477640654135003im -0.0013682787250991829 - 0.0002887896509352433im -0.003997563173948943 - 0.007964014659786684im -0.005307821871982992 - 0.0051917653444897354im -0.0037852589339260985 - 4.5408057192831454e-5im -0.0033126987125450466 - 0.005043363558890925im 0.06920112361761986 - 0.12501342599759954im 0.0044694421796487695 + 0.00022661198463265302im 0.008356685545272635 + 0.005412021162441566im 0.004057624036774276 + 0.005678730586166729im 0.0035482169786490167 - 0.0021846410108435172im; -0.012117571154286784 - 0.016267601892973917im -7.470383006483472e-5 + 0.0003285202384194988im 0.00885839481680314 + 0.011178447214266259im -0.008523805555382562 - 0.011373372928930122im -0.0025725139360736 + 0.002944368128655641im -0.05030004676626075 + 0.14098691034840632im 0.012879133837597591 + 0.017248598222798922im -0.0011390391412928135 + 0.0010386956377625048im -0.0075162881157390705 - 0.01381415192706396im -3.378714149664065e-5 + 0.03306451410913738im -0.00022635381381827608 + 0.00025103967850128244im 0.0003841740819052414 - 0.023775395157513087im -0.01375974568643752 - 0.00022712072949192594im -0.0034547042744494027 + 9.102978923532439e-6im 0.1649057104517447 + 8.920686556805393e-23im 0.00011684012198204573 - 0.03655308635041024im -0.0014120512759559548 + 0.00028851108142490857im 0.0021050065306739657 + 0.02561408565808015im 0.004757051697634912 + 0.008025338865131293im 0.004593607083461782 - 0.0006230092721937002im 0.003075265964044914 - 0.005723386914895127im 0.0032693724135338543 + 0.005483318525771478im -0.0044873058764848634 - 0.0002798213383145274im 0.059899053243687855 - 0.1247143900019202im -0.005056045358654757 - 0.008635401838308195im 0.0012427717677895686 - 0.0017485519656275494im 0.0016918829301397174 + 0.0060795872376553746im; -0.004909153830590785 - 0.004946044266574077im -0.005641806514734649 - 0.008424637076395024im -0.006047851005607316 - 0.008043580479535318im -0.00632472875158608 - 0.0148881460594924im -0.014295315663784355 - 0.01541703383158892im -0.012857176971966157 - 0.01702592244130702im -0.05892872287378521 + 0.1322680588168994im -0.004339084888031543 - 0.00096286066276329im -0.0022962708699511506 - 0.0030195986417138583im -0.007675996280700228 - 0.00012093341531712949im 0.00043284750170036234 + 0.017843860337389633im -0.009919971187501618 - 0.0005587628108598288im 0.0032640500257490306 + 0.025857859811523772im -0.022776273032648578 + 0.0005659385198161483im 0.00011684012198204558 + 0.03655308635041024im 0.15291649870461493 + 6.938928062037542e-18im -0.0026563855040698287 + 0.0065467779069176574im -0.0036022557197451263 + 0.00046379567938592455im 0.005555679474542316 + 0.0014098863569577602im 0.0022291668793378364 + 0.003795517905581452im 0.0023236543032229993 + 0.003869171605141636im 0.004118878652641485 + 0.005625181493599878im 0.008309665218243285 + 0.005316125183711967im 0.004880148198283297 + 0.008256705396871452im 0.06998723899126374 - 0.12108160243520968im 0.0009885711084955586 + 0.0019324491772746341im 0.0009293221978478278 + 0.0017720307421689027im; 0.006415936488128878 + 0.00769366987419648im 0.0038466904591681183 + 0.006108190605087679im 0.0002247240024435193 - 0.00033951467176570954im 0.011317118265617624 + 0.018786826382897817im 0.010630243022978308 + 0.010346881073724766im -0.0011356115883155433 + 0.0010377302248987589im 0.0003264330874207785 + 0.005281750995866754im -0.05665931190735288 + 0.13739674820030556im -0.0013794178599413661 + 0.0015526787999411787im 0.0005050647911695843 - 0.01687858791326365im 0.00645479939946563 - 0.00020783955517506393im 0.00039309065866746813 - 2.647816705743659e-5im 0.018899392267842888 + 0.0008506029349023191im 0.0021136077368459163 - 0.026477640654134996im -0.0014120512759559546 - 0.00028851108142490813im -0.0026563855040698287 - 0.006546777906917659im 0.15569814020922004 + 6.939040055092913e-18im -0.0019055120896834977 - 0.00043980830147108955im -0.002300513536370105 - 0.003926309900571488im -0.0032215256818120884 - 0.003464423372040736im -0.005031227624476567 + 0.00011459220326987202im -0.0016360695099621736 - 0.011172064461064656im -0.004115113156084087 - 0.005805380564369226im 0.0012377392839920563 - 0.0017645822523164123im -0.001018877793061756 - 0.0020040619865969566im 0.07356840906134418 - 0.12579081715172435im 0.002260610637743064 - 8.398078162684028e-5im; -0.00608085322395609 - 0.008189302785574601im 0.0003110953762144521 - 0.00022909069968949142im 0.003902334758464467 + 0.006185113737311535im -0.012927770392612566 - 0.017334732005732368im -0.0009947104075074518 + 0.0012416583141854206im 0.010728991283369042 + 0.010465972251482185im -0.0023089288793621374 - 0.003074374408652989im -0.0014530522980078617 + 0.0014782794382224825im -0.05635769306988275 + 0.13645445766045433im -0.009746169039843787 - 0.000793750614650961im 0.00027190526684966207 + 2.258692348787406e-5im 0.006472879117617352 + 0.0004797072984286675im -0.00010302637340528931 + 0.035739911917514286im -0.0013682787250991826 + 0.0002887896509352424im 0.002105006530673963 - 0.025614085658080155im -0.0036022557197451267 - 0.00046379567938592466im -0.001905512089683497 + 0.0004398083014710904im 0.1546102542691874 - 6.9388358189699336e-18im 0.002419750391829556 + 0.004142666221146727im 0.005005059471061775 - 0.00010532492558595723im 0.006778229214439701 - 0.003652951667115497im 0.0051174464687348716 + 0.008842203616424718im 0.003554394617757929 - 0.0021877787375242726im -0.0017464590561560075 - 0.006201377115672085im 0.0009799584666304031 + 0.001894226655860757im -0.0022694273538228556 + 6.779467610761774e-5im 0.06857561634215585 - 0.12483920057978617im; -0.15214875209787043 - 0.0013355966851724462im 0.02300680860749305 + 0.019443542118886607im -0.01713375136345608 - 0.022611780526067007im -0.00895755090063686 - 0.01083468759286345im 0.011623688193535427 + 0.01599455637068351im -0.012041432270875268 - 0.015907272701089888im -0.005091424904532537 - 0.005155181729878938im 0.005517715043109834 + 0.00818604380726605im -0.006035717173729223 - 0.007960941739822222im 0.06711094561237102 + 0.10812473228531035im -0.006658146668594274 + 0.01053369346203086im 0.006577885990363758 - 0.01133411820620436im 0.005261496795634218 - 0.004953424096063021im -0.003997563173948946 + 0.007964014659786687im 0.004757051697634913 - 0.008025338865131295im 0.005555679474542314 - 0.0014098863569577597im -0.002300513536370105 + 0.00392630990057149im 0.002419750391829556 - 0.004142666221146724im 0.23469253273418159 - 1.734583495184365e-18im -0.006088074770975663 - 0.04846299497369262im 0.027745306228383084 + 0.0013235354143295312im 0.0005271239188694073 + 0.023976128347594362im -0.0191102114202973 - 0.0010265155061201985im 0.00025573260948936837 + 0.03306533469508396im 0.007752766709901582 + 0.00010488333886480994im 0.0003965044487737725 - 0.016875943185622466im 0.009734885595524873 + 0.0007257385482349792im; -0.010907989401033482 - 0.025783539750817604im -0.13171531184456298 + 0.032538268778042966im 0.004403642523039199 - 0.001999427456392964im -0.012292873267000378 - 0.015784640745919898im 0.008084373792649239 + 0.011380231842122095im -0.00012608614085961634 + 0.0002542579855905634im -0.006504692720377915 - 0.007752635805735716im 0.003718123922149689 + 0.005881983447421779im -0.0003020189497330941 + 0.00023118318251005051im 0.006484597589518373 - 0.010170676941424029im 0.06112602499667884 + 0.12757708302175041im 0.003301351316966729 + 0.0004366923285483242im 0.005007904230843102 - 0.006775158484514862im -0.0053078218719829935 + 0.00519176534448974im 0.004593607083461782 + 0.0006230092721936991im 0.0022291668793378424 - 0.0037955179055814523im -0.0032215256818120866 + 0.003464423372040737im 0.005005059471061774 + 0.00010532492558595766im -0.006088074770975663 + 0.04846299497369262im 0.19877715799933104 - 3.4693434225786178e-18im -0.0040899113294205975 + 0.0007850936935906453im 0.01978054907509381 - 0.000843151976535418im 0.0003149872173295566 - 0.024848708671037407im 0.00016196795352463997 - 0.00024878013555900953im 0.0004771362696371495 + 0.017844072387657978im -0.0064388719876854695 + 0.00022840254133738675im 0.00027219734614844065 + 2.5024532647196443e-5im; -0.017192059665831275 - 0.022973733039912455im 0.0041566062430174935 - 0.0023709179347976323im -0.13057828640161637 + 0.03267369948761611im -0.012082302643831238 - 0.01616186878005158im -0.00033293579828869233 - 1.6571071789476535e-5im 0.008234526694147357 + 0.011581402816511873im -0.006056306258876157 - 0.008088454567164153im -0.00038829591374639553 + 0.00012110828391061407im 0.003773705075623875 + 0.005958172149457841im 0.0062187019932402055 - 0.010572789529944263im -0.0033181458431981786 - 0.0003936143866930146im 0.06750701422319896 + 0.12760467627192817im 0.004493968677125969 - 0.0074890461479444215im -0.0037852589339260976 + 4.540805719283167e-5im 0.003075265964044914 + 0.005723386914895124im 0.0023236543032229932 - 0.003869171605141635im -0.005031227624476567 - 0.00011459220326987202im 0.006778229214439699 + 0.003652951667115497im 0.02774530622838308 - 0.0013235354143295243im -0.004089911329420598 - 0.0007850936935906461im 0.19737152609096084 - 3.469348132078091e-18im -0.00010544400893992614 + 0.033778147249103295im 0.00022732934022533054 + 0.0002543826641747888im 0.00023706325348830777 - 0.023774720902580017im 0.009904715934802362 + 0.0005722438416563272im 0.0003940844747665614 - 2.67028023600478e-5im -0.0064714575506884964 - 0.0004583101972844496im; 0.007806427323491806 + 0.01149193995809228im -0.012285334031726044 - 0.015742564921136737im 0.012060297770914838 + 0.01598955348226954im -0.14758660248031294 + 0.0076920799028789896im 0.013240391768699587 + 0.008635728281808376im -0.008489436137278778 - 0.011187035046483164im -0.01248439753098305 - 0.010185774305142259im 0.010836831214037019 + 0.017932268703283218im -0.012824742676786514 - 0.016962494362832488im -0.005196544130508334 + 0.004823891338513243im 0.0050513082356464616 - 0.006868188610236026im -0.004662462792166767 + 0.007847111189151882im 0.06399058143358431 + 0.11416485385457759im -0.0033126987125450483 + 0.005043363558890934im 0.003269372413533856 - 0.005483318525771481im 0.004118878652641489 - 0.005625181493599878im -0.001636069509962177 + 0.011172064461064647im 0.005117446468734882 - 0.008842203616424718im 0.0005271239188694113 - 0.023976128347594366im 0.019780549075093804 + 0.0008431519765354127im -0.00010544400893992836 - 0.0337781472491033im 0.2260361716358526 + 3.4695930054496776e-18im -0.004735586395529758 - 0.024168815763326634im 0.013918157005754746 + 0.0001700504249945039im 0.0033694577237384504 + 0.025864499871853096im -0.018949588512812126 - 0.0007694446857789826im 0.0001547732798493173 + 0.0357411361691575im; 0.011653044658391279 + 0.016205261688170196im -0.00878396962317825 - 0.011082355329525579im -0.0003323068240648911 - 1.6261868108180236e-5im -0.003487535885407236 - 0.013690404320915572im -0.1384076381660929 + 0.025019096054836397im 0.0035167657080125542 - 0.0016486328055084387im -0.01476708034516782 - 0.01607331710914471im 0.006946445193172182 + 0.013045742221682984im -0.001300498077867928 + 0.000806951906972818im -0.0037928325594078684 + 0.007539700583190438im 0.005255094132864357 - 0.005079995512599761im -0.003781619788076466 + 3.137777974205149e-5im 0.0032257778779588315 - 0.004865037550968314im 0.06920112361761986 + 0.12501342599759951im -0.004487305876484863 + 0.00027982133831452676im 0.008309665218243285 - 0.005316125183711961im -0.004115113156084087 + 0.005805380564369223im 0.0035543946177579292 + 0.002187778737524273im -0.019110211420297295 + 0.001026515506120202im 0.00031498721732955596 + 0.024848708671037414im 0.0002273293402253306 - 0.0002543826641747888im -0.004735586395529758 + 0.024168815763326634im 0.2090241157683437 + 6.938971151782414e-18im -0.0032934142292369334 - 1.9782765641137185e-8im 0.022725064900467676 - 0.000553356281954427im 0.0019593967835008345 - 0.026474244505552715im 0.0012657171078341754 - 0.00028141576737000454im; 0.012100837727410092 + 0.01624513099134516im -0.00012876581540758225 + 0.0002561498370562776im -0.008936308375407228 - 0.011282421984825933im -0.00851841244804348 - 0.011366146953639201im 0.003374869563851966 - 0.0018725355447481462im -0.13735085805424221 + 0.02506209435438075im -0.012868193836353197 - 0.017233968969807414im -0.0014619084611033355 + 0.0006082841695876492im 0.007035497766306523 + 0.01317521441864072im -0.004419538540991832 + 0.007312619685411938im 0.004594997642687888 + 0.0006158128632378723im -0.0031268471279483415 - 0.005617599758096855im 0.0030922543403544677 - 0.005112456920717329im 0.004469442179648769 - 0.00022661198463265171im 0.05989905324368787 + 0.1247143900019202im 0.004880148198283297 - 0.008256705396871452im 0.0012377392839920576 + 0.0017645822523164121im -0.0017464590561560075 + 0.0062013771156720875im 0.0002557326094893703 - 0.033065334695083964im 0.00016196795352463943 + 0.0002487801355590091im 0.00023706325348830712 + 0.023774720902580013im 0.013918157005754746 - 0.0001700504249945039im -0.0032934142292369334 + 1.9782765642004543e-8im 0.2074438122410403 - 1.7346510811071753e-18im -0.00010951788897167217 + 0.036553539436033934im 0.00131179774026134 + 0.0002872639349440885im 0.0019055242135246437 - 0.025610412784649372im; -0.005109927963599559 - 0.005214530719669139im 0.005526298043525209 + 0.008270652835353361im -0.0060495167581499565 - 0.008045794544054848im 0.0055074232488871045 + 0.013797482347327im -0.014754825816751107 - 0.016028327328854824im 0.012868084708067207 + 0.017040387544481127im -0.14683404245265466 + 0.015205297031878874im 0.004948117184800187 + 0.0017713812190872861im -0.00230002146802565 - 0.003024560920556129im 0.005491339806880444 - 0.0012772560254116013im -0.002211033957258507 + 0.0037596437563583523im 0.002366726965609655 - 0.003962625927771489im -0.004058431652812907 + 0.005495274731561688im 0.008356685545272639 - 0.005412021162441574im -0.005056045358654754 + 0.008635401838308198im 0.06998723899126377 + 0.1210816024352097im -0.0010188777930617583 + 0.0020040619865969566im 0.0009799584666304031 - 0.001894226655860756im 0.007752766709901587 - 0.00010488333886481341im 0.00047713626963714905 - 0.017844072387657978im 0.009904715934802358 - 0.0005722438416563298im 0.0033694577237384556 - 0.025864499871853082im 0.022725064900467683 + 0.0005533562819544322im -0.000109517888971668 - 0.03655353943603394im 0.22224185642645128 + 8.674280574015334e-19im -0.0026116570026685545 - 0.0065536463123335165im 0.0036914865059601114 + 0.0004479643487308528im; -0.006523189246928549 - 0.007837545763301017im 0.0037222895115981256 + 0.00594183243890852im -0.00030547769887129207 + 0.00023186278220879234im 0.010847529751277342 + 0.0181582080797676im -0.011112086392913615 - 0.010989891293245534im -0.0014583125442104198 + 0.0006084384770934115im 0.00028394978724543163 - 0.00446635889632839im -0.14445037667774305 + 0.020486144674483675im 0.0018075538458579236 - 0.0009843089642630985im 0.0021527685343581612 - 0.003618222437992887im -0.0031642593198646157 + 0.0033366117665884925im 0.0050292416471894264 + 0.00012440392062097im -0.0014246864184040385 + 0.010707810404187088im 0.004057624036774276 - 0.005678730586166738im 0.001242771767789569 + 0.0017485519656275498im 0.000988571108495562 - 0.0019324491772746367im 0.07356840906134418 + 0.1257908171517243im -0.0022694273538228556 - 6.77946761076185e-5im 0.00039650444877377096 + 0.016875943185622466im -0.006438871987685469 - 0.00022840254133738675im 0.0003940844747665616 + 2.670280236004791e-5im -0.01894958851281213 + 0.0007694446857789792im 0.0019593967835008315 + 0.02647424450555271im 0.0013117977402613405 - 0.0002872639349440894im -0.0026116570026685558 + 0.006553646312333515im 0.21733246628961658 - 1.7346289423067393e-18im -0.0017669921056637468 + 0.00043390668285726044im; -0.006069696542521888 - 0.008174289998465065im -0.00039199199544815864 + 0.0001205712812296746im 0.0037780092495824373 + 0.0060188571952521745im 0.01291153340644422 + 0.017312927548291286im -0.001318148024211586 + 0.0008086884880350121im -0.011210492165933646 - 0.01110852483210517im -0.002308005854380072 - 0.0030731367296011297im 0.001882137715509066 - 0.0009050790742962979im -0.14360324810324673 + 0.02027030328711821im 0.00220797354130336 - 0.0036909859413618846im -0.005002320797298209 - 0.00012551978950191452im 0.006830418750369749 + 0.0035558480958931367im -0.004750548376116728 + 0.008051695196196702im 0.0035482169786490167 + 0.002184641010843517im 0.001691882930139714 - 0.006079587237655372im 0.0009293221978478273 - 0.0017720307421689016im 0.0022606106377430634 + 8.398078162684028e-5im 0.06857561634215582 + 0.12483920057978612im 0.009734885595524875 - 0.0007257385482349801im 0.00027219734614844043 - 2.502453264719677e-5im -0.006471457550688496 + 0.00045831019728445133im 0.000154773279849321 - 0.0357411361691575im 0.0012657171078341762 + 0.00028141576737000367im 0.0019055242135246385 + 0.025610412784649372im 0.0036914865059601114 - 0.00044796434873085325im -0.0017669921056637473 - 0.00043390668285725914im 0.21617456179690284 + 1.7347969513994226e-18im]
    W_1_bath_ = W_1_bath_3(t, p, tmp1, tmp2)
    @test D(ref, W_1_bath_) < 1e-11

    W_1_bath_ = W_1_bath_3(t, W0, W0_bath, agg)
    @test D(ref, W_1_bath_) < 1e-11

end